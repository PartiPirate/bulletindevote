<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="">
	<meta name="author" content="Parti Pirate">

	<title>Mon Bulletin De Vote</title>

	<!-- Facebook -->
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://bulletindevote.partipirate.org/" />
	<meta property="og:title" content="Parti Pirate - Mon Bulletin De Vote" />
	<meta property="og:description" content="Imprimer votre bulletin de vote pour le Parti Pirate" />
	<meta property="og:image" content="https://bulletindevote.partipirate.org/assets/img/logo_voile_fond.png" />
	<meta property="og:locale" content="fr_FR" />
	<meta property="og:locale:alternate" content="en_US" />
	<meta property="fb:page_id" content="partipiratefr" />

	<!-- Google +1 -->
	<meta itemprop="name" content="Parti Pirate - Mon Bulletin De Vote" />
	<meta itemprop="description" content="Imprimer votre bulletin de vote pour le Parti Pirate" />
	<meta itemprop="image" content="https://bulletindevote.partipirate.org/assets/img/logo_voile_fond.png" />
	<meta itemprop="author" content="farlistener" />

	<!-- Twitter -->
	<meta name="twitter:site" content="@partipirate" />
	<meta name="twitter:creator" content="@farlistener" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:url" content="https://bulletindevote.partipirate.org/" />
	<meta name="twitter:title" content="Parti Pirate - Europ&eacute;ennes 2019" />
	<meta name="twitter:description" content="Imprimer votre bulletin de vote pour le Parti Pirate" />
	<meta name="twitter:image" content="https://bulletindevote.partipirate.org/assets/img/logo_voile_fond.png" />
	<meta name="twitter:image:alt" content="Logo du Parti Pirate" />


	<!-- Bootstrap Core CSS -->
	<link href="assets/css/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css">

	<!-- Fonts -->
	<link href="assets/css/plugins/fontawesome/css/all.css" rel="stylesheet" type="text/css">
	<!-- <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'> -->

	<!-- Retina Images Plugin -->
	<script src="assets/js/plugins/retina/retina.min.js"></script>

	<!-- Plugin CSS -->
	<link href="assets/css/plugins/hover/hover.min.css" rel="stylesheet">
	<link href="assets/css/plugins/owl.carousel/owl.carousel.css" rel="stylesheet">
	<link href="assets/css/plugins/owl.carousel/owl.theme.css" rel="stylesheet">
	<link href="assets/css/plugins/owl.carousel/owl.transitions.css" rel="stylesheet">
	<link href="assets/css/plugins/jquery.fs.wallpaper/jquery.fs.wallpaper.css" rel="stylesheet">
	<link href="assets/css/plugins/magnific-popup/magnific-popup.css" rel="stylesheet">

	<!-- Spectrum CSS -->
	<!-- Note: spectrum.css is the default blue theme. To use another theme, uncomment the one you want and delete the rest, including the default spectrum.css! -->
	<link href="assets/css/spectrum.css" rel="stylesheet">
	<link href="assets/css/pp.css" rel="stylesheet">
    <link href="assets/css/donations-gauge.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="assets/js/html5shiv.js"></script>
      <script src="assets/js/respond.min.js"></script>
    <![endif]-->
</head>
<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

	<!-- Piwik -->
	<script type="text/javascript">
	  var _paq = _paq || [];
	  _paq.push(["setDomains", ["*.recrutement.partipirate.org", "*.candidature.partipirate.org"]]);
	  _paq.push(['trackPageView']);
	  _paq.push(['enableLinkTracking']);
	  (function() {
	    var u="//piwik.partipirate.org/";
	    _paq.push(['setTrackerUrl', u+'piwik.php']);
	    _paq.push(['setSiteId', 3]);
	    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
	    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
	  })();
	</script>
	<noscript><p><img src="//piwik.partipirate.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
	<!-- End Piwik Code -->

    <div id="wrapper">

        <nav class="navbar navbar-dark navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                        <i class="fa fa-bars"></i>
                    </button>
                    <a class="navbar-brand" href="#page-top">
                        <span class="logo">
                            <img src="assets/img/logo.png" alt="">
                        </span>
                    </a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
                    <ul class="nav navbar-nav">
                        <!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                        <li class="hidden">
                            <a href="#page-top"></a>
                        </li>
                        <!--<li class="page-scroll">
                            <a href="#team">Notre équipe</a>
                        </li>-->
                        <li class="page-scroll">
                            <a href="#print">Imprimer votre bulletin</a>
                        </li>
                        <li class="page-scroll">
                            <a href="#finance">Financer des bulletins</a>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container -->
        </nav>

		<aside class="bg-parallax-light nopadding" style="background-image: url(assets/img/demo-bgs/fond.png);" data-stellar-background-ratio="0" id="intro">
            <div class="aside-overlay">
                <div class="container">
                    <div class="row text-center">
                        <div class="col-lg-10 col-lg-offset-1 page-scroll"  data-scrollreveal="enter bottom after .6s">
							<br /><br />
							<p class="text-center">Le suffrage universel doit permettre à tout le monde de s'exprimer<br> et, alors que <strong style="color: white;">33 listes</strong> se sont présentées à ces élections européennes en France,<br>nous savons pertinemment que nous ne trouverons pas 33 bulletins de vote dans nos bureaux de vote.</p>
							<p class="text-center"><strong style="color: white;">Pourquoi ?</strong></p>
							<p class="text-center">Parce que <strong style="color: white;">les bulletins de vote</strong> doivent être fournis par les têtes de liste <strong style="color: white;">pour toutes les personnes</strong> qui votent.<br />
							D'après notre imprimeur préféré, cela couterait au minimum <strong style="color: white;">270 000€</strong>.</p>
							<p class="text-center" style="color: white; font-size: larger;"><strong style="color: white;">Oui, nous aussi, on trouve ça inadmissible.</strong></p>
							<p class="text-center">Tout comme la plupart des "petits" partis qui ne sont financés que par les dons de leurs soutiens, nous, Pirates, ne sommes pas en capacité d'imprimer nos bulletins de vote nous mêmes.</p>
							<p class="text-center">Aussi, nous regrettons amèrement de vous demander d'<strong style="color: white;">imprimer vous-mêmes votre bulletin</strong>. </p>
							<p class="text-center"><strong style="color: white;">Mais</strong> nous nous sommes dit que, quitte à en imprimer un, on pourrait vous demander <br> d'<strong style="color: white;">en imprimer quelques uns de plus, et pourquoi pas pour toute votre commune,</strong> <br>tout le département ou, voyons grand, pour toute votre région&nbsp;?</p>
							<p class="text-center">Vous verrez, ça ne coûte pas aussi cher qu'on le pense, quand <strong style="color: white;">la dépense est partagée...</strong></p>
							<p class="text-center">Alors, nous aiderez-vous à <strong style="color: white;">pirater le système</strong> ?</p>
                            <a href="#print" class="btn btn-outline btn-dark btn-lg btn-square" style="color: white;">Imprimez votre bulletin de vote !</a>
                            <a href="#finance" class="btn btn-outline btn-dark btn-lg btn-square" style="color: white;">Financez des bulletins de vote !</a>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

		        <!-- Services/Features Option 2 -->
        <section id="help" class="services-2">
            <div class="container">
                <div class="row" data-scrollreveal="move 0 over 1s">
                    <div class="col-lg-12 text-center">
                        <h2>Des bulletins disponibles mais où ?</h2>
                        <hr class="primary">
						<p>Consulter notre carte de disponibilité : </p>
						<div align="center" data-scrollreveal="enter bottom move 600px over 2s">
                        	<div id="mapid" style="width: 800px; height: 600px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
		        <!-- Services/Features Option 2 -->
        <section id="print" class="services-2">
            <div class="container">
                <div class="row" data-scrollreveal="move 0 over 1s">
                    <div class="col-lg-12 text-center">
                        <h2>Comment imprimer mon bulletin de vote ?</h2>
                        <hr class="primary">
						<p>Consulter notre vidéo d'explication (en cours de production) : </p>
						<div data-scrollreveal="enter top move 200px over 1s">
                            <img src="assets/img/YouTube.png" alt="">
                        </div>
                    </div>
                    <div class="col-lg-8 col-lg-offset-2 text-center">
                        <p>Pour nous accompagner dans cette campagne, nous avons besoin de votre aide.</p>
                    </div>
					<div class="row" data-scrollreveal="enter bottom over 1s">
                    <div class="col-lg-6 services-col">
                        <div class="row">
                            <div class="col-sm-3 text-center text-primary"><i class="fa fa-4x fa-money-bill-wave"></i>
                            </div>
                            <div class="col-sm-9">
                                <h3>Nous aider financièrement</h3>
                                <p>Pour pouvoir nous présenter, nous avons besoin d'imprimer des bulletins de votes, des tracts, etc. Pour cela, un seul lien : <a href="https://don.partipirate.org/project.php?id=143&skip=" target="blank">Donner au Parti Pirate</a></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 services-col">
                        <div class="row">
                            <div class="col-sm-3 text-center text-primary"><i class="fa fa-4x fa-users"></i>
                            </div>
                            <div class="col-sm-9">
                                <h3>Imprimer votre bulletin de vote</h3>
                                <p>Vous pouvez le télécharger ici : <a href="bulletindevote.pdf">Le Bulletin</a></p>
                                <p>Attention, il est préférable d'utiliser du <strong>papier A4 70g/m<sup>2</sup></strong> pour imprimer votre bulletin, le papier usuel pouvant entraîner la nullité du bulletin suivant la complaisance du président du bureau de vote.</p>
                            </div>
                        </div>
					</div>
                </div>
                </div>
            </div>
        </section>



<section id="finance" class="contact-1">	
<div class="container">	

<div id="response" class="row simply-hidden">	
<div class="col-lg-12" data-scrollreveal="enter left over 1s">	
<h2>L'information des bulletins nous est parvenue, </h2>	
<p>Merci pour votre participation, nous reviendrons vers vous rapidement (par courriel).</p>	
</div>	

<div class="text-center">	
<button type="submit" class="ijoinButton btn btn-lg btn-primary btn-square btn-raised">Je veux aussi adhérer</button>	
<button type="submit" class="idonateButton btn btn-lg btn-primary btn-square btn-raised">Je veux aussi donner</button>	
</div>	
</div>	

<div class="text-center contactForm-title">	
<h2>Je veux aider le Parti Pirate à proposer <strong>des bulletins</strong> dans tous les <strong>bureaux de vote</strong></h2>
<hr class="primary">
</div>	

<form name="sentMessage" id="contactForm" novalidate>
	<input type="hidden" id="destinations-input" name="destinations-input">
<div class="row">	
<div class="col-lg-6" data-scrollreveal="enter left over 1s">	
<p class="text-justify">
Plutôt que d'imprimer un seul bulletin pour vous, pour lequel vous devrez de toute façon acheter <a target="_blank" href="https://www.legifrance.gouv.fr/affichCodeArticle.do;jsessionid=1483F30F5A9DED0247F24FEF5D5C0170.tplgfr37s_1?cidTexte=LEGITEXT000006070239&idArticle=LEGIARTI000037537073&dateTexte=20190505&categorieLien=id#LEGIARTI000037537073">une ramette spécifique (papier 70g/m<sup>2</sup>) difficile à trouver dans le commerce</a>, vous pouvez prôner l'idée du partage Pirate jusque dans les urnes en apportant des bulletins de vote à votre mairie pour que tout le monde puisse voter Pirate le 26 mai. 
</p>
<p class="text-justify">
Pour cela vous pouvez vous rendre chez votre imprimeur préféré et lui demander de tirer autant de bulletins de vote que vous aurez de <strong>paquets de 100, 200 ou 500 feuilles A4 de 70g/m<sup>2</sup></strong> à lui fournir ou qu'il arrivera à commander si vous vous y prenez suffisament tôt.
</p>
<p class="text-justify">
Nous vous invitons à indiquer, dans le formulaire, la ou les régions, le ou les départements, la ou les villes que vous vous engagez à fournir en bulletins de vote, ainsi qu'un mail pour rester en contact, au cas où.	
</p>
<p class="text-justify">
Une fois imprimés, ces bulletins devront être apportés par <strong>paquets de 100, 200 ou 500</strong> aux différentes <strong>mairies que vous vous engagez à alimenter avant le 24 mai</strong>.
</p>
<p class="text-center">
<a href="bulletindevote.pdf" class="btn btn-primary">Télécharger le bulletin</a>
</p>
</div>	
<div class="col-lg-6 col-lg-offset-0" data-scrollreveal="enter right over 1s">	
<br>	
<input type="text" name="email" class="hidden" value="">	

<fieldset>	
<legend>	
<a href="#identityCollapse" data-toggle="collapse" data-target="#identityCollapse" aria-expanded="true" 	
aria-controls="identityCollapse" data-parent="form">Bulletins</a>	
</legend>	

<div class="collapse in" id="identityCollapse">	

<!-- Language input-->	
<div class="form-group">	
    <label class="col-md-5 control-label">Niveau de distribution</label>	
    <div class="col-md-7">	
        <input id="zoneInput" name="zoneInput" value="" type="hidden">	
        <div id="zoneButtons" class="btn-group" role="group" aria-label="…">	
            <button value="region" type="button" class="btn btn-default">Région</button>	
            <button value="departement" type="button" class="btn btn-default">Département</button>	
            <button value="villes" type="button" class="btn btn-default">Ville</button>	
        </div>	
        <p class="help-block">	
        Attention à prendre en compte aussi les délais et les coûts éventuels de livraison.
        </p>	
    </div>	
</div>

<div class="clearfix"></div>

<div class="form-group">	
    <label class="col-md-5 control-label">Proportion de bulletins</label>	
    <div class="col-md-3">	
    	<select id="proportion" class="form-control">
    		<option value="5">5%</option>
    		<option value="10" selected="selected">10%</option>
    		<option value="15">15%</option>
    		<option value="20">20%</option>
    		<option value="25">25%</option>
    		<option value="30">30%</option>
    		<option value="35">35%</option>
    		<option value="40">40%</option>
    		<option value="45">45%</option>
    		<option value="50">50%</option>
<!--    		
    		<option value="55">55%</option>
    		<option value="60">60%</option>
    		<option value="65">65%</option>
    		<option value="70">70%</option>
-->    		
    	</select>
        <p class="help-block">	
        </p>	
    </div>
    <div class="col-md-5">
        &nbsp;
    </div>
</div>

<div class="clearfix"></div>

<div class="form-group has-feedback zone-dependant zone-region">	
    <label class="col-md-5 control-label">Région</label>	
    <div class="col-md-7">	
        <select class="form-control" placeholder="La région à financer" id="region-select" name="region">
        	<option value=""></option>
        </select>
        <p class="help-block">	
        </p>	
    </div>	
</div>

<div class="clearfix"></div>

<div class="form-group has-feedback zone-dependant zone-departement zone-villes">	
    <label class="col-md-5 control-label">Département</label>	
    <div class="col-md-7">	
        <select class="form-control" placeholder="Le département à financer" id="departement-select" name="department">
        	<option value=""></option>
        </select>
        <p class="help-block">	
        </p>	
    </div>	
</div>

<div class="clearfix"></div>

<div class="form-group has-feedback zone-dependant zone-villes">	
    <label class="col-md-5 control-label">Ville ou code postal</label>	
    <div class="col-md-7">	
        <input type="text" class="form-control" placeholder="Ville (ou code postal)" id="city-autocomplete" name="city">	
        <p class="help-block">	
        </p>	
    </div>	
</div>

<div class="clearfix"></div>

<div class="form-group" id="selection">
</div>
<div class="form-group" id="ballots">
	Nombre de bulletins : <span id="ballots-span"></span>
</div>
<div class="form-group" id="price">
	Investissement indicatif : <span id="price-span"></span>
</div>

<div class="clearfix"></div>

<div class="form-group">
  <label class="col-md-4 control-label" for="add-destination-button"></label>
  <div class="col-md-4">
    <button id="add-destination-button" type="button" class="btn btn-primary">Ajouter</button>
  </div>
</div>

<div class="clearfix"></div>

</div>	
</fieldset>	
</div>	
</div>                    	

<div class="row">	
<div class="col-lg-12" data-scrollreveal="enter left over 1s">	

<br>

<div id="destinations">
	<div class="row">
		<div class="col-xs-2 text-left">Zone</div>
		<div class="col-xs-2 text-right">Nombre de villes</div>
		<div class="col-xs-2 text-right">Proportion de bulletin</div>
		<div class="col-xs-3 text-right">Nombre de bulletin</div>
		<div class="col-xs-2 text-right">Prix (indication)</div>
		<div class="col-xs-1 text-right"></div>
	</div>
</div>

<div class="clearfix"></div>
<br><br>
<div class="clearfix"></div>

<div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton">Total de bulletins</label>
    <div class="col-md-2">
        <span id="total-ballots-span">0</span>
    </div>
    <label class="col-md-4 control-label" for="singlebutton">Prix total</label>
    <div class="col-md-2">
        <span id="total-price-span">0,00 &euro;</span>
    </div>
</div>

<br><br>

</div>	
</div>                    	

<div class="row">	
<div class="col-lg-12" data-scrollreveal="enter left over 1s">	

<fieldset>	
    <legend>	
    Et vous êtes ?
    </legend>	
    
    <div class="form-group has-feedback">	
        <div class="form-group col-xs-6 floating-label-form-group controls">	
            <label>Votre adresse mail …</label>	
            <input type="text" class="form-control" placeholder="Votre adresse mail …" id="xxx" name="xxx" required data-validation-required-message="Veuillez entrer votre addresse mel.">	
            <p class="help-block text-danger"></p>	
        </div>	
        <div class="form-group col-xs-6 floating-label-form-group controls">	
            <label>… et sa confirmation</label>	
            <input type="text" class="form-control" placeholder="… et sa confirmation" id="confirmationMail" name="confirmationMail" required data-validation-required-message="Veuillez entrer une confirmation pour votre adresse mel.">	
            <p class="help-block text-danger"></p>	
        </div>	
    </div>	

	<div class="form-group">	
		<div class="col-md-2 control-label" style="text-align: right;">	
			<input id="accept_notification" name="accept_notification" value="1" type="checkbox" class="input-md">	
		</div>	
		<div class="col-md-10 padding-left-0">	
			<label class="form-control labelForCheckbox" for="accept_notification" style="border: none; background: none; -webkit-box-shadow: none;">En cochant cette case j'autorise	
			le Parti Pirate à m'envoyer régulièrement des informations sur son activité.</label>	
		</div>	
	</div>	

</fieldset>	

<br>	
<div id="success"></div>	
<div class="row">	
<div class="form-group col-xs-12 text-center">	
<button id="finance-button" type="submit" class="btn btn-lg btn-primary btn-square btn-raised">Je participe</button>	
</div>	
</div>	
</div>                           	
</div>	
</form>	
</div>	
</section>	
         
         
         
         
         
         







	<footer class="footer-1">
            <div class="upper">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <h2 class="script">Parti Pirate</h2>
                            <address>
                                21, rue de la République<br>
                                75003 Paris<br>
							</address>
                        </div>
                        <div class="col-md-3">
                            <h4>Liens</h4>
                            <ul class="list-unstyled footer-links">
                                <li>
                                    <a href="https://www.partipirate.org" target="_blank">Site du Parti Pirate</a>
                                </li>
                                <li>
                                    <a href="https://wiki.partipirate.org" target="_blank">Wiki du Parti Pirate</a>
                                </li>
                            </ul>
                        </div>

                        <div class="col-md-3" style="text-align:center;">
                            <h4>Social</h4>
                            <ul class="list-inline">
                                <li>
                                    <a href="https://www.facebook.com/partipiratefr/" target="_blank" class="btn btn-social-light btn-facebook"><i class="fab fa-facebook"></i></a>
                                </li>
                                <li>
                                    <a href="https://twitter.com/partipirate" target="_blank" class="btn btn-social-light btn-twitter"><i class="fab fa-twitter"></i></a>
                                </li>
                                <li>
                                    <a href="https://mastodon.partipirate.org/@PartiPirate" target="_blank" class="btn btn-social-light btn-twitter btn-mastodon" style="text-decoration: none;"><i class="fab fa-mastodon"></i></a>
                                </li>
                                <li>
                                    <a href="https://discord.partipirate.org" target="_blank" class="btn btn-social-light btn-twitter btn-discord" style="text-decoration: none;"><i class="fab fa-discord"></i></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="lower">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <span class="small"><a href="licences.html" title="Information licence">Mentions légales</a></span>
                        </div>
                    </div>
                </div>
            </div>
	</footer>
	</div>

	<div id="volunteerVeil" class="text-center simply-hidden">
		<img src="assets/img/logo_pp.png" alt="Logo du Parti Pirate">
	</div>

	<script src="assets/js/min.js"></script>
	<script src="assets/js/pp.js"></script>
    <script src="assets/js/donations-gauge.js"></script>	

    <!-- Script to Activate Formstone Wallpaper jQuery Plugin - Use this script if you want to use an .mp4, .ovg, or .webm video as a background video. -->
    <script>
    $(".video-bg").wallpaper({
        source: {
            poster: "assets/img/demo-bgs/FondProgramme.jpg"
        }
    });
    </script>
    
<!-- MAP -->    

<!--
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
	integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
	crossorigin="" />
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
	integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
	crossorigin=""></script>
-->	
<link rel="stylesheet" href="leaflet.css"
	integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
	crossorigin="" />
<script src="leaflet.js"
	integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
	crossorigin=""></script>

<style>
	html,
	body {
		height: 100%;
		margin: 0;
	}

	#map {
		width: 800px;
		height: 600px;
	}

	.info {
		padding: 6px 8px;
		font: 14px/16px Arial, Helvetica, sans-serif;
		background: white;
		background: rgba(255, 255, 255, 0.8);
		box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
		border-radius: 5px;
	}

	.info h4 {
		margin: 0 0 5px;
		color: #777;
	}

	.legend {
		text-align: left;
		line-height: 18px;
		color: #555;
	}

	.legend i {
		width: 18px;
		height: 18px;
		float: left;
		margin-right: 8px;
		opacity: 0.7;
	}
</style>
<script type="text/javascript" src="do_getBallotCities.php"></script>
<script type="text/javascript" src="candidates.js"></script>
<script type="text/javascript" src="printers.js"></script>
<script>
	/* load Icons */
	var assets = [{name: "printer", file: "assets/printer.svg"}, {name: "candidat", file: "assets/candidat.svg"}];
	assets.forEach(function(data) {
		data.icon = L.icon({
			iconUrl: data.file,
			iconSize: [24, 24]
		});
	});

	var DefaultCoordinates = [46.75, 2.3];
	var DefaultZoom = 6;

	function getCoordinates() {
		var url = new URL(window.location);
		var city = url.searchParams.get("city");
		var rtn = DefaultCoordinates;
		citiesData.features.forEach(
			function (data) {
				if (data.properties.name.toLowerCase() == city) {
					console.log("city " + city + " found in data")
					rtn = data.properties.defaultCoordinates
				} else {
				}
			}
		);
		return rtn;
	}

	function getZoom() {
		var coordinates = getCoordinates();
		if (coordinates[0] != DefaultCoordinates[0]) {
			return 13;
		} else {
			return DefaultZoom;
		}
	}

	var map = L.map('mapid').setView(getCoordinates(), getZoom());

	//L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.light'
	}).addTo(map);

	// control that shows state info on hover
	var info = L.control();

	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

	info.update = function (props) {
		this._div.innerHTML = '<h4>Bulletins</h4>' + (props ?
			'<b>' + props.name + '</b><br />' + props.pourcent + ' '
			: ' n/d ');
	};

	info.addTo(map);


	// get color depending on population pourcent value
	function getColor(d) {
		d = ("" + d).replace("%", "") * 1.;
/*
		return d > 100 ? '#800026' :
			d > 90 ? '#BD0026' :
				d > 75 ? '#E31A1C' :
					d > 50 ? '#FC4E2A' :
						d > 25 ? '#FD8D3C' :
							d > 20 ? '#FEB24C' :
								d > 10 ? '#FED976' :
									'#FFEDA0';
*/									
		return d > 50 ? '#40FF40' : // OK
			d > 40 ? '#60FF20' :
				d > 30 ? '#A0FF10' :
					d > 25 ? '#FFFF00' :
						d > 20 ? '#FFE000' :
							d > 15 ? '#FFD000' :
								d > 10 ? '#FFC000' :
									'#FFA500'; // OK
	}

	function style(feature) {
		return {
			weight: 2,
			opacity: 1,
			color: 'black',
			dashArray: '3',
			fillOpacity: 0.8,
			fillColor: getColor(feature.properties.pourcent)
		};
	}

	function highlightFeature(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 2,
			color: '#333',
			dashArray: '',
			fillOpacity: 0.8
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}

		info.update(layer.feature.properties);
	}

	var geojson;

	function resetHighlight(e) {
		geojson.resetStyle(e.target);
		info.update();
	}

	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}

	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
	}

	geojson = L.geoJson(citiesData, {
		style: style,
		onEachFeature: onEachFeature
	}).addTo(map);


	/* legend de la carte */

	var legend = L.control({ position: 'bottomright' });

	legend.onAdd = function (map) {

		var div = L.DomUtil.create('div', 'info legend'),
			grades = [0, 10, 15, 20, 25, 30, 40, 50],
			labels = [],
			from, to;

		for (var i = 0; i < grades.length; i++) {
			from = grades[i];
			to = grades[i + 1];

			labels.push('<i style="background:' + getColor(from + 1) + '"></i> ' + from + "%" + (to ? '&ndash;' + to + "%" : ''));
		}

		div.innerHTML = labels.join('<br>');
		return div;
	};

	legend.addTo(map);

	/* mark for candidates */
	var markersCandidates = [];
	candidates.forEach(function(data) {
		var marker = L.marker(data.coordinates, {icon: assets.find(function(data) { return data.name == this; }, "candidat").icon }).bindPopup(data.popup);
		markersCandidates.push(marker) 
	});
	var layerCandidates = L.layerGroup(markersCandidates);

	/* mark for imprimeurs */
	var markersPrinters = [];
	printers.forEach(function(data) {
		var marker = L.marker(data.coordinates, {icon: assets.find(function(data) { return data.name == this; }, "printer").icon }).bindPopup(data.popup);
		markersPrinters.push(marker) 
	});
	var layerPrinters = L.layerGroup(markersPrinters);

	var overlayMaps = {
		"Pirates": layerCandidates,
		"Imprimeurs": layerPrinters
	};

	L.control.layers(null, overlayMaps).addTo(map);
</script>

<!-- END MAP -->

<!-- BULLETIN -->

<script type="text/javascript" src="do_getRegions.php"></script>
<script type="text/javascript" src="do_getDepartments.php"></script>
<script>
var proportion = 10;
var ratio = 0.75;
/*
var regions = <?=json_encode($allRegions)?>;
var departments = <?=json_encode($allDepartments)?>;
*/

//var regions = [];
//var departments = [];

var numberFormat = new Intl.NumberFormat('fr-FR', {});
var priceFormat = new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' });
var actualSearch = null;

function computeTotals() {
	var totalBallots = 0;
	$("#destinations .nb-ballots").each(function() {
		totalBallots += $(this).data("nb-ballots");
	})

	var totalPrice = getPrice(totalBallots);

    $("#total-ballots-span").text(numberFormat.format(totalBallots));
    $("#total-price-span").text(priceFormat.format(totalPrice));
}

function addSearch() {
	if (!actualSearch) return;

	var row = $("<div class='row destination'></div>");

	row.data("type", actualSearch.type);
	row.data("proportion", actualSearch.proportion);
	row.data("insee", actualSearch["insee"]);

	row.append($("<div class='col-xs-3 zone text-left'></div>").text(actualSearch.region ? actualSearch.region : (actualSearch.city ? actualSearch.city : actualSearch.department)));
	row.append($("<div class='col-xs-1 nb-cities text-right'></div>").text(actualSearch.numberOfCities));
	row.append($("<div class='col-xs-1 proportion text-right'></div>").text(actualSearch.proportion + "%"));
	row.append($("<div class='col-xs-3 nb-ballots text-right'></div>").text(numberFormat.format(actualSearch.numberOfBallots)).data("nb-ballots", actualSearch.numberOfBallots));
	row.append($("<div class='col-xs-3 price text-right'></div>").text(priceFormat.format(actualSearch.price)));

	var actionDiv = $("<div class='col-xs-1 action text-right'></div>");

	row.append(actionDiv);

	actionDiv.append($("<button class='btn btn-xs btn-danger btn-remove-destination'><i class='fas fa-times'></i></button>"));

	$("#destinations").append(row);

	row.find(".btn-remove-destination").click(function() {
		$(this).parents(".destination").remove();
		computeTotals();
	});

	computeTotals();
}

function numberOfElectors(numberOfHabitants) {
	return numberOfHabitants * ratio;
}

function getDepartment(name) {
	for(var index = 0; index < departments.length; ++index) {
		if (departments[index].dep_name == name) return departments[index];
	}

	return null;
}

function getRegion(name) {
	for(var index = 0; index < regions.length; ++index) {
		if (regions[index].reg_name == name) return regions[index];
	}

	return null;
}

function getNumberOfBallots(parameters) {

	var responseHandler = function(data) {
		const numberOfBallots = data.numberOfBallots;
		const price = getPrice(numberOfBallots);

		actualSearch["numberOfCities"] = data.numberOfCities;
		actualSearch["numberOfBallots"] = numberOfBallots;
		actualSearch["price"] = price;

		if (data.numberOfCities == 1) {
			actualSearch["insee"] = data.cities[0].cit_insee;
		}

		if (!$("#selection").html()) {
			var text = "Nombre de villes : " + data.numberOfCities;
			
			if (data.numberOfCities < 20) {
				separator = " (";
				for(var index = 0; index < data.cities.length; ++index) {
					text += separator;
					text += data.cities[index].cit_name;
					
					separator = ", ";
				}
				
				if (data.numberOfCities > 0) {
					text += ")";
				}
			}

			text += "<br>Population : " + numberFormat.format(data.population * 1000) + " habitants<br>Electeurs : ~" + numberFormat.format(data.electors);
			$("#selection").html(text);
		}

		$("#price-span").html(priceFormat.format(price));
		$("#ballots-span").html(numberFormat.format(numberOfBallots));
	};

	actualSearch = parameters;
	$.post("do_getNumberOfBallots.php", parameters, responseHandler, "json");
}

function getPrice(numberOfBallots) {
	if (numberOfBallots == 0) return 0;
	if (numberOfBallots == 100) return 60;
	if (numberOfBallots == 200) return 70;
	if (numberOfBallots <= 500) return 70 + 5 * (numberOfBallots - 200) / 100;
	if (numberOfBallots <= 1000) return 85 + 3 * (numberOfBallots - 500) / 100;
	if (numberOfBallots <= 10000) return 100 + 2.22 * (numberOfBallots - 1000) / 100;

	return (numberOfBallots) * 0.0183;
}

$(function() {

	$("#add-destination-button").click(function(event) {
		event.stopImmediatePropagation();
		event.preventDefault();
		addSearch();
	});

	$("#region-select").change(function() {
		var region = getRegion($(this).val());

		if (region) {
			$("#selection").html("Region : " + region.reg_name + "<br>Nombre de villes : " + region.reg_number_of_cities + "<br>Population : " + numberFormat.format(region.reg_population * 1000) + " habitants<br>Electeurs : ~" + numberFormat.format(numberOfElectors(region.reg_population * 1000)));

			getNumberOfBallots({"region" : region.reg_name, "proportion": proportion, type: "region"});
		}
		else {
			$("#selection").html("");
			actualSearch = null;
		}
	});

	$("#departement-select").change(function() {
		var department = getDepartment($(this).val());
		$("#city-autocomplete").val("");

		if (department) {
			$("#selection").html("Departement : " + department.dep_name + "<br>Nombre de villes : " + department.dep_number_of_cities + "<br>Population : " + numberFormat.format(department.dep_population * 1000) + " habitants<br>Electeurs : ~" + numberFormat.format(numberOfElectors(department.dep_population * 1000)));

			getNumberOfBallots({"department" : department.dep_name, "proportion": proportion, type: "departement"});
		}
		else {
			$("#selection").html("");
			actualSearch = null;
		}
	});

	$("#city-autocomplete").keyup(function() {
		var department = getDepartment($("#departement-select").val());
		var city = $(this).val();

		if (city) {
//			$("#selection").html("Departement : " + department.dep_name + "<br>Nombre de villes : " + department.dep_number_of_cities + "<br>Population : " + numberFormat.format(department.dep_population * 1000) + " habitants<br>Electeurs : ~" + numberFormat.format(numberOfElectors(department.dep_population * 1000)));

			$("#selection").html("");
			
			var parameters = {"city" : city, "proportion": proportion, type: "villes"};
			if (department) {
				parameters["department"] = department.dep_name;
			}
			
			getNumberOfBallots(parameters);
		}
		else {
			$("#selection").html("");
			actualSearch = null;
		}
	});

	$("#proportion").change(function() {
		proportion = $(this).val();

		switch($("#zoneInput").val()) {
			case "villes": 
				$("#city-autocomplete").keyup();
				break;
			case "departement": 
				$("#departement-select").change();
				break;
			case "region": 
				$("#region-select").change();
				break;
		}

	});
});

</script>

<!-- END BULLETIN -->

</body>

</html>

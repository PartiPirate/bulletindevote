<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="">
	<meta name="author" content="Parti Pirate">

	<title>Mon Bulletin De Vote</title>

	<!-- Facebook -->
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://bulletindevote.partipirate.org/" />
	<meta property="og:title" content="Parti Pirate - Mon Bulletin De Vote" />
	<meta property="og:description" content="Imprimer votre bulletin de vote pour le Parti Pirate" />
	<meta property="og:image" content="https://bulletindevote.partipirate.org/assets/img/logo.png" />
	<meta property="og:locale" content="fr_FR" />
	<meta property="og:locale:alternate" content="en_US" />
	<meta property="fb:page_id" content="partipiratefr" />

	<!-- Google +1 -->
	<meta itemprop="name" content="Parti Pirate - Mon Bulletin De Vote" />
	<meta itemprop="description" content="Imprimer votre bulletin de vote pour le Parti Pirate" />
	<meta itemprop="image" content="https://bulletindevote.partipirate.org/assets/img/logo.png" />
	<meta itemprop="author" content="farlistener" />

	<!-- Twitter -->
	<meta name="twitter:site" content="@partipirate" />
	<meta name="twitter:creator" content="@farlistener" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:url" content="https://bulletindevote.partipirate.org/" />
	<meta name="twitter:title" content="Parti Pirate - Europ&eacute;ennes 2019" />
	<meta name="twitter:description" content="Je veux participer aux europ&eacute;ennes 2019 avec le Parti Pirate" />
	<meta name="twitter:image" content="https://bulletindevote.partipirate.org/assets/img/logo.png" />
	<meta name="twitter:image:alt" content="Logo du Parti Pirate" />


	<!-- Bootstrap Core CSS -->
	<link href="assets/css/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css">

	<!-- Fonts -->
	<link href="assets/css/plugins/fontawesome/css/all.css" rel="stylesheet" type="text/css">
	<!-- <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'> -->

	<!-- Retina Images Plugin -->
	<script src="assets/js/plugins/retina/retina.min.js"></script>

	<!-- Plugin CSS -->
	<link href="assets/css/plugins/hover/hover.min.css" rel="stylesheet">
	<link href="assets/css/plugins/owl.carousel/owl.carousel.css" rel="stylesheet">
	<link href="assets/css/plugins/owl.carousel/owl.theme.css" rel="stylesheet">
	<link href="assets/css/plugins/owl.carousel/owl.transitions.css" rel="stylesheet">
	<link href="assets/css/plugins/jquery.fs.wallpaper/jquery.fs.wallpaper.css" rel="stylesheet">
	<link href="assets/css/plugins/magnific-popup/magnific-popup.css" rel="stylesheet">

	<!-- Spectrum CSS -->
	<!-- Note: spectrum.css is the default blue theme. To use another theme, uncomment the one you want and delete the rest, including the default spectrum.css! -->
	<link href="assets/css/spectrum.css" rel="stylesheet">
	<link href="assets/css/pp.css" rel="stylesheet">
    <link href="assets/css/donations-gauge.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="assets/js/html5shiv.js"></script>
      <script src="assets/js/respond.min.js"></script>
    <![endif]-->
</head>
<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

	<!-- Piwik -->
	<script type="text/javascript">
	  var _paq = _paq || [];
	  _paq.push(["setDomains", ["*.recrutement.partipirate.org", "*.candidature.partipirate.org"]]);
	  _paq.push(['trackPageView']);
	  _paq.push(['enableLinkTracking']);
	  (function() {
	    var u="//piwik.partipirate.org/";
	    _paq.push(['setTrackerUrl', u+'piwik.php']);
	    _paq.push(['setSiteId', 3]);
	    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
	    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
	  })();
	</script>
	<noscript><p><img src="//piwik.partipirate.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
	<!-- End Piwik Code -->

    <div id="wrapper">

        <nav class="navbar navbar-dark navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                        <i class="fa fa-bars"></i>
                    </button>
                    <a class="navbar-brand" href="#page-top">
                        <span class="logo">
                            <img src="assets/img/logo.png" alt="">
                        </span>
                    </a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
                    <ul class="nav navbar-nav">
                        <!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                        <li class="hidden">
                            <a href="#page-top"></a>
                        </li>
                        <!--<li class="page-scroll">
                            <a href="#team">Notre équipe</a>
                        </li>-->
                        <li class="page-scroll">
                            <a href="#print">Imprimer votre bulletin</a>
                        </li>
                        <li class="page-scroll">
                            <a href="#finance">Financer des bulletins</a>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container -->
        </nav>

<!--        <header class="video-bg">
            <div class="intro-video intro-dark-bg container">
                <div class="overlay"></div>
                <div class="intro-body">
                    <div class="container">
                        <span class="page-scroll">
                            <a href="#print" class="btn btn-primary btn-square btn-lg">Je veux imprimer mon bulletin de vote pour le Parti Pirate</a>
                        </span>
                        <span class="page-scroll">
                            <a href="#finance" class="btn btn-primary btn-square btn-lg">Je veux financer des bulletins de vote pour le Parti Pirate</a>
                        </span>
                        <br>
                        <br>
                        <h1 class="brand-heading">
                            Imprimer<br><span class="text-primary">mon bulletin de vote</span>
                        </h1>
                        <hr class="light">
                        <div class="carousel slide" data-ride="carousel">
                            <div class="carousel-inner">
                                <div class="item">
                                    <h4>Protéger l’égalité des droits des citoyens grâce à des institutions humaines et transparentes</h4>
                                </div>
                                <div class="item">
                                    <h4>Défendre les libertés fondamentales sur Internet comme dans la vie quotidienne</h4>
                                </div>
                                 <div class="item active">
                                    <h4>Partager fraternellement les savoirs culturels et scientifiques de l’humanité</h4>
                                </div>
                           </div>
                        </div>
                        <div class="page-scroll" data-scrollreveal="enter bottom after .6s">
                            <a href="#intro" class="btn btn-scroll-light sink">
                                <i class="fa fa-angle-double-down"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>-->

		<aside class="bg-parallax-light nopadding" style="background-image: url(assets/img/demo-bgs/fond.png);" data-stellar-background-ratio="0" id="intro">
            <div class="aside-overlay">
                <div class="container">
                    <div class="row text-center">
                        <div class="col-lg-8 col-lg-offset-2 page-scroll"  data-scrollreveal="enter bottom after .6s">
							<br /><br />
							<p class="text-justify">En France, nous avons le droit de vote, mais la charge de l'impression des bulletins de vote échoit aux candidats qui se présentent. Nous devons donc payer pour que vous ayez le droit de voter pour nous.</p>
							<p class="text-justify">Le suffrage universel, qui doit permettre à tous les élécteurs de s'exprimer, mais l'Etat, plutôt que de vouloir vous voir faire émerger de nouvelles idées, préfère rembourser les gros partis qui pourront continuer à s'exprimer.</p>
							<h2>Mais il existe une alternative : vous.</h2>
							<p class="text-justify">Vous pouvez nous aidez en imprimant vous-mêmes vos bulletins, pour vous, vos proches voire tous ceux qui en veulent.</p>
                            <a href="#print" class="btn btn-outline btn-dark btn-lg btn-square">Imprimez votre bulletin de vote !</a>
                            <a href="#finance" class="btn btn-outline btn-dark btn-lg btn-square">Financez des bulletins de vote !</a>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

		        <!-- Services/Features Option 2 -->
        <section id="help" class="services-2">
            <div class="container">
                <div class="row" data-scrollreveal="move 0 over 1s">
                    <div class="col-lg-12 text-center">
                        <h2>Des bulletins disponibles mais où ?</h2>
                        <hr class="primary">
						<p>Consulter notre carte de disponibilité : </p>
						<div align="center" data-scrollreveal="enter bottom move 600px over 2s">
                        	<div id="mapid" style="width: 800px; height: 600px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
		        <!-- Services/Features Option 2 -->
        <section id="print" class="services-2">
            <div class="container">
                <div class="row" data-scrollreveal="move 0 over 1s">
                    <div class="col-lg-12 text-center">
                        <h2>Comment imprimer mon bulletin de vote ?</h2>
                        <hr class="primary">
						<p>Consulter notre vidéo d'explication : </p>
						<div data-scrollreveal="enter top move 200px over 1s">
                            <img src="assets/img/YouTube.png" alt="">
                        </div>
                    </div>
                    <div class="col-lg-8 col-lg-offset-2 text-center">
                        <p>Pour nous accompagner dans cette campagne, nous avons besoin de votre aide.</p>
                    </div>
					<div class="row" data-scrollreveal="enter bottom over 1s">
                    <div class="col-lg-6 services-col">
                        <div class="row">
                            <div class="col-sm-3 text-center text-primary"><i class="fa fa-4x fa-money-bill-wave"></i>
                            </div>
                            <div class="col-sm-9">
                                <h3>Nous aider financièrement</h3>
                                <p>Pour pouvoir nous présenter, nous avons besoin d'imprimer des bulletins de votes, des tracts, etc. Pour cela, un seul lien : <a href="https://don.partipirate.org/project.php?id=143&skip=" target="blank">Donner au Parti Pirate</a></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 services-col">
                        <div class="row">
                            <div class="col-sm-3 text-center text-primary"><i class="fa fa-4x fa-users"></i>
                            </div>
                            <div class="col-sm-9">
                                <h3>Imprimer votre bulletin de vote</h3>
                                <p>Vous pouvez le télécharger ici : (bulletin en cours de réalisation)</p>
                            </div>
                        </div>
					</div>
                </div>
                </div>
            </div>
        </section>



<section id="finance" class="contact-1">	
<div class="container">	

<div id="response" class="row simply-hidden">	
<div class="col-lg-12" data-scrollreveal="enter left over 1s">	
<h2>L'information des bulletins nous est parvenue, </h2>	
<p>Merci pour votre participation, nous gardons précieusement votre proposition de candidature et d'aide pour les européennes 2019 en faveur du Parti Pirate</p>	
</div>	

<div class="text-center">	
<button type="submit" class="ijoinButton btn btn-lg btn-primary btn-square btn-raised">Je veux aussi adhérer</button>	
<button type="submit" class="idonateButton btn btn-lg btn-primary btn-square btn-raised">Je veux aussi donner</button>	
</div>	
</div>	

<form name="sentMessage" id="contactForm" novalidate>
	<input type="hidden" id="destinations-input" name="destinations-input">
<div class="row">	
<div class="col-lg-5" data-scrollreveal="enter left over 1s">	
<h2>Je veux aider le Parti Pirate et ses bulletins</h2>	
<p>	
Le Parti Pirate est un mouvement politique international ralliant	
celles et ceux qui aspirent à une société capable de :<br> <br>	
</p>	
<ul>	
<li>Partager fraternellement les savoirs culturels et scientifiques de l’humanité ;</li>
<li>Protéger l’égalité des droits des citoyens grâce à des institutions humaines et transparentes ;</li>
<li>Défendre les libertés fondamentales sur Internet comme dans la vie quotidienne.</li>
<li>Promouvoir les valeurs <a href="https://partipirate.org/le-code-des-pirates/" alt="Code des pirates">du code des pirates</a></li>
</ul>	
</div>	
<div class="col-lg-6 col-lg-offset-1" data-scrollreveal="enter right over 1s">	
<br>	
<input type="text" name="email" class="hidden" value="">	

<fieldset>	
<legend>	
<a href="#identityCollapse" data-toggle="collapse" data-target="#identityCollapse" aria-expanded="true" 	
aria-controls="identityCollapse" data-parent="form">Vous</a>	
</legend>	

<div class="collapse in" id="identityCollapse">	

<!-- Language input-->	
<div class="form-group">	
    <label class="col-md-5 control-label">Niveau de distribution</label>	
    <div class="col-md-7">	
        <input id="zoneInput" name="zoneInput" value="" type="hidden">	
        <div id="zoneButtons" class="btn-group" role="group" aria-label="…">	
            <button value="region" type="button" class="btn btn-default">Région</button>	
            <button value="departement" type="button" class="btn btn-default">Département</button>	
            <button value="villes" type="button" class="btn btn-default">Villes</button>	
        </div>	
        <p class="help-block">	
        Attention à prendre aussi les délais de livraison
        </p>	
    </div>	
</div>

<div class="clearfix"></div>

<div class="form-group">	
    <label class="col-md-5 control-label">Proportion de bulletins</label>	
    <div class="col-md-2">	
    	<select id="proportion" class="form-control">
    		<option value="5">5%</option>
    		<option value="10" selected="selected">10%</option>
    		<option value="15">15%</option>
    		<option value="20">20%</option>
    		<option value="25">25%</option>
    		<option value="30">30%</option>
    		<option value="35">35%</option>
    		<option value="40">40%</option>
<!--    		
    		<option value="45">45%</option>
    		<option value="50">50%</option>
    		<option value="55">55%</option>
    		<option value="60">60%</option>
    		<option value="65">65%</option>
    		<option value="70">70%</option>
-->    		
    	</select>
        <p class="help-block">	
        </p>	
    </div>
    <div class="col-md-5">
        &nbsp;
    </div>
</div>

<div class="clearfix"></div>

<div class="form-group has-feedback zone-dependant zone-region">	
    <label class="col-md-5 control-label">Région</label>	
    <div class="col-md-7">	
        <select class="form-control" placeholder="La région à financer" id="region-select" name="region">
        	<option value=""></option>
        </select>
        <p class="help-block">	
        </p>	
    </div>	
</div>

<div class="clearfix"></div>

<div class="form-group has-feedback zone-dependant zone-departement">	
    <label class="col-md-5 control-label">Département</label>	
    <div class="col-md-7">	
        <select class="form-control" placeholder="Le département à financer" id="departement-select" name="department">
        	<option value=""></option>
        </select>
        <p class="help-block">	
        </p>	
    </div>	
</div>

<div class="clearfix"></div>

<div class="form-group has-feedback zone-dependant zone-villes">	
    <label class="col-md-5 control-label">Villes</label>	
    <div class="col-md-7">	
        <input type="text" class="form-control" placeholder="Ville (ou code postal)" id="city-autocomplete" name="city">	
        <p class="help-block">	
        </p>	
    </div>	
</div>

<div class="clearfix"></div>

<div class="form-group" id="selection">
</div>
<div class="form-group" id="ballots">
	Nombre de bulletins : <span id="ballots-span"></span>
</div>
<div class="form-group" id="price">
	Investissement : <span id="price-span"></span>
</div>

<div class="clearfix"></div>

<div class="form-group">
  <label class="col-md-4 control-label" for="add-destination-button"></label>
  <div class="col-md-4">
    <button id="add-destination-button" type="button" class="btn btn-primary">Ajouter</button>
  </div>
</div>

<div class="clearfix"></div>

<div id="destinations">
</div>

<div class="clearfix"></div>

<div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton">Total de bulletins</label>
    <div class="col-md-2">
        <span id="total-ballots-span"></span>
    </div>
    <label class="col-md-4 control-label" for="singlebutton">Prix total</label>
    <div class="col-md-2">
        <span id="total-price-span"></span>
    </div>
</div>





</div>	
</fieldset>	
</div>	
</div>                    	


<div class="row">	
<div class="col-lg-12" data-scrollreveal="enter left over 1s">	

<fieldset>	
    <legend>	
    Et vous êtes ?
    </legend>	
    
    <div class="form-group has-feedback">	
        <div class="form-group col-xs-6 floating-label-form-group controls">	
            <label>Votre adresse mail …</label>	
            <input type="text" class="form-control" placeholder="Votre adresse mail …" id="xxx" name="xxx" required data-validation-required-message="Veuillez entrer votre addresse mel.">	
            <p class="help-block text-danger"></p>	
        </div>	
        <div class="form-group col-xs-6 floating-label-form-group controls">	
            <label>… et sa confirmation</label>	
            <input type="text" class="form-control" placeholder="… et sa confirmation" id="confirmationMail" name="confirmationMail" required data-validation-required-message="Veuillez entrer une confirmation pour votre adresse mel.">	
            <p class="help-block text-danger"></p>	
        </div>	
    </div>	

</fieldset>	

<br>	
<div id="success"></div>	
<div class="row">	
<div class="form-group col-xs-12">	
<button id="finance-button" type="submit" class="btn btn-lg btn-primary btn-square btn-raised">J'ai financé</button>	
</div>	
</div>	
</div>                           	
</div>	
</form>	
</div>	
</section>	
         
         
         
         
         
         







	<footer class="footer-1">
            <div class="upper">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <h2 class="script">Parti Pirate</h2>
                            <address>
                                21, rue de la République<br>
                                75003 Paris<br>
							</address>
                        </div>
                        <div class="col-md-3">
                            <h4>Liens</h4>
                            <ul class="list-unstyled footer-links">
                                <li>
                                    <a href="https://www.partipirate.org" target="_blank">Site du Parti Pirate</a>
                                </li>
                                <li>
                                    <a href="https://wiki.partipirate.org" target="_blank">Wiki du Parti Pirate</a>
                                </li>
                            </ul>
                        </div>

                        <div class="col-md-3" style="text-align:center;">
                            <h4>Social</h4>
                            <ul class="list-inline">
                                <li>
                                    <a href="https://www.facebook.com/partipiratefr/" target="_blank" class="btn btn-social-light btn-facebook"><i class="fab fa-facebook"></i></a>
                                </li>
                                <li>
                                    <a href="https://twitter.com/partipirate" target="_blank" class="btn btn-social-light btn-twitter"><i class="fab fa-twitter"></i></a>
                                </li>
                                <li>
                                    <a href="https://mastodon.partipirate.org/@PartiPirate" target="_blank" class="btn btn-social-light btn-twitter btn-mastodon" style="text-decoration: none;"><i class="fab fa-mastodon"></i></a>
                                </li>
                                <li>
                                    <a href="https://discord.partipirate.org" target="_blank" class="btn btn-social-light btn-twitter btn-discord" style="text-decoration: none;"><i class="fab fa-discord"></i></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="lower">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <span class="small"><a href="licences.html" title="Information licence">Mentions légales</a></span>
                        </div>
                    </div>
                </div>
            </div>
	</footer>
	</div>

	<div id="volunteerVeil" class="text-center simply-hidden">
		<img src="assets/img/logo_pp.png" alt="Logo du Parti Pirate">
	</div>

	<script src="assets/js/min.js"></script>
	<script src="assets/js/pp.js"></script>
    <script src="assets/js/donations-gauge.js"></script>	

    <!-- Script to Activate Formstone Wallpaper jQuery Plugin - Use this script if you want to use an .mp4, .ovg, or .webm video as a background video. -->
    <script>
    $(".video-bg").wallpaper({
        source: {
            poster: "assets/img/demo-bgs/FondProgramme.jpg"
        }
    });
    </script>
    
<!-- MAP -->    
    
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
	integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
	crossorigin="" />
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
	integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
	crossorigin=""></script>
<style>
	html,
	body {
		height: 100%;
		margin: 0;
	}

	#map {
		width: 800px;
		height: 600px;
	}

	.info {
		padding: 6px 8px;
		font: 14px/16px Arial, Helvetica, sans-serif;
		background: white;
		background: rgba(255, 255, 255, 0.8);
		box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
		border-radius: 5px;
	}

	.info h4 {
		margin: 0 0 5px;
		color: #777;
	}

	.legend {
		text-align: left;
		line-height: 18px;
		color: #555;
	}

	.legend i {
		width: 18px;
		height: 18px;
		float: left;
		margin-right: 8px;
		opacity: 0.7;
	}
</style>
<script type="text/javascript" src="do_getBallotCities.php"></script>
<script type="text/javascript" src="candidates.js"></script>
<script type="text/javascript" src="printers.js"></script>
<script>
	/* load Icons */
	var assets = [{name: "printer", file: "assets/printer.svg"}, {name: "candidat", file: "assets/candidat.svg"}];
	assets.forEach(function(data) {
		data.icon = L.icon({
			iconUrl: data.file,
			iconSize: [24, 24]
		});
	});

	var DefaultCoordinates = [47.0, 2.3];
	var DefaultZoom = 6;

	function getCoordinates() {
		var url = new URL(window.location);
		var city = url.searchParams.get("city");
		var rtn = DefaultCoordinates;
		citiesData.features.forEach(
			function (data) {
				if (data.properties.name.toLowerCase() == city) {
					console.log("city " + city + " found in data")
					rtn = data.properties.defaultCoordinates
				} else {
				}
			}
		);
		return rtn;
	}

	function getZoom() {
		var coordinates = getCoordinates();
		if (coordinates[0] != DefaultCoordinates[0]) {
			return 13;
		} else {
			return DefaultZoom;
		}
	}

	var map = L.map('mapid').setView(getCoordinates(), getZoom());

	//L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.light'
	}).addTo(map);

	// control that shows state info on hover
	var info = L.control();

	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

	info.update = function (props) {
		this._div.innerHTML = '<h4>Bulletins</h4>' + (props ?
			'<b>' + props.name + '</b><br />' + props.pourcent + ' '
			: ' n/d ');
	};

	info.addTo(map);


	// get color depending on population pourcent value
	function getColor(d) {
		return d > 100 ? '#800026' :
			d > 90 ? '#BD0026' :
				d > 75 ? '#E31A1C' :
					d > 50 ? '#FC4E2A' :
						d > 25 ? '#FD8D3C' :
							d > 20 ? '#FEB24C' :
								d > 10 ? '#FED976' :
									'#FFEDA0';
	}

	function style(feature) {
		return {
			weight: 2,
			opacity: 1,
			color: 'black',
			dashArray: '3',
			fillOpacity: 0.8,
			fillColor: getColor(feature.properties.pourcent)
		};
	}

	function highlightFeature(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 2,
			color: '#333',
			dashArray: '',
			fillOpacity: 0.8
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}

		info.update(layer.feature.properties);
	}

	var geojson;

	function resetHighlight(e) {
		geojson.resetStyle(e.target);
		info.update();
	}

	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}

	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
	}

	geojson = L.geoJson(citiesData, {
		style: style,
		onEachFeature: onEachFeature
	}).addTo(map);


	/* legend de la carte */

	var legend = L.control({ position: 'bottomright' });

	legend.onAdd = function (map) {

		var div = L.DomUtil.create('div', 'info legend'),
			grades = [0, 10, 20, 25, 50, 75, 90, 100],
			labels = [],
			from, to;

		for (var i = 0; i < grades.length; i++) {
			from = grades[i];
			to = grades[i + 1];

			labels.push('<i style="background:' + getColor(from + 1) + '"></i> ' + from + (to ? '&ndash;' + to : ''));
		}

		div.innerHTML = labels.join('<br>');
		return div;
	};

	legend.addTo(map);

	/* mark for candidates */
	var markersCandidates = [];
	candidates.forEach(function(data) {
		var marker = L.marker(data.coordinates, {icon: assets.find(function(data) { return data.name == this; }, "candidat").icon }).bindPopup(data.popup);
		markersCandidates.push(marker) 
	});
	var layerCandidates = L.layerGroup(markersCandidates);

	/* mark for imprimeurs */
	var markersPrinters = [];
	printers.forEach(function(data) {
		var marker = L.marker(data.coordinates, {icon: assets.find(function(data) { return data.name == this; }, "printer").icon }).bindPopup(data.popup);
		markersPrinters.push(marker) 
	});
	var layerPrinters = L.layerGroup(markersPrinters);

	var overlayMaps = {
		"Pirates": layerCandidates,
		"Imprimeurs": layerPrinters
	};

	L.control.layers(null, overlayMaps).addTo(map);
</script>

<!-- END MAP -->

<!-- BULLETIN -->

<script type="text/javascript" src="do_getRegions.php"></script>
<script type="text/javascript" src="do_getDepartments.php"></script>
<script>
var proportion = 10;
var ratio = 0.75;
/*
var regions = <?=json_encode($allRegions)?>;
var departments = <?=json_encode($allDepartments)?>;
*/

//var regions = [];
//var departments = [];

var numberFormat = new Intl.NumberFormat('fr-FR', {});
var priceFormat = new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' });
var actualSearch = null;

function computeTotals() {
	var totalBallots = 0;
	$("#destinations .nb-ballots").each(function() {
		totalBallots += $(this).data("nb-ballots");
	})

	var totalPrice = getPrice(totalBallots);

    $("#total-ballots-span").text(numberFormat.format(totalBallots));
    $("#total-price-span").text(priceFormat.format(totalPrice));
}

function addSearch() {
	if (!actualSearch) return;
	
	var row = $("<div class='row'></div>");

	row.data("type", actualSearch.type);

	row.append($("<div class='col-xs-3 zone text-left'></div>").text(actualSearch.region ? actualSearch.region : (actualSearch.department ? actualSearch.department : actualSearch.city)));
	row.append($("<div class='col-xs-3 nb-cities text-right'></div>").text(actualSearch.numberOfCities));
	row.append($("<div class='col-xs-3 nb-ballots text-right'></div>").text(numberFormat.format(actualSearch.numberOfBallots)).data("nb-ballots", actualSearch.numberOfBallots));
	row.append($("<div class='col-xs-3 price text-right'></div>").text(priceFormat.format(actualSearch.price)));

	$("#destinations").append(row);

	computeTotals();
}

function numberOfElectors(numberOfHabitants) {
	return numberOfHabitants * ratio;
}

function getDepartment(name) {
	for(var index = 0; index < departments.length; ++index) {
		if (departments[index].dep_name == name) return departments[index];
	}

	return null;
}

function getRegion(name) {
	for(var index = 0; index < regions.length; ++index) {
		if (regions[index].reg_name == name) return regions[index];
	}

	return null;
}

function getNumberOfBallots(parameters) {

	var responseHandler = function(data) {
		const numberOfBallots = data.numberOfBallots;
		const price = getPrice(numberOfBallots);

		actualSearch["numberOfCities"] = data.numberOfCities;
		actualSearch["numberOfBallots"] = numberOfBallots;
		actualSearch["price"] = price;

		if (!$("#selection").html()) {
			var text = "Nombre de villes : " + data.numberOfCities;
			
			if (data.numberOfCities < 20) {
				separator = " (";
				for(var index = 0; index < data.cities.length; ++index) {
					text += separator;
					text += data.cities[index].cit_name;
					
					separator = ", ";
				}
				
				if (data.numberOfCities > 0) {
					text += ")";
				}
			}

			text += "<br>Population : " + numberFormat.format(data.population * 1000) + " habitants<br>Electeurs : ~" + numberFormat.format(data.electors);
			$("#selection").html(text);
		}

		$("#price-span").html(priceFormat.format(price));
		$("#ballots-span").html(numberFormat.format(numberOfBallots));
	};

	actualSearch = parameters;
	$.post("do_getNumberOfBallots.php", parameters, responseHandler, "json");
}

function getPrice(numberOfBallots) {
	if (numberOfBallots == 0) return 0;
	if (numberOfBallots == 100) return 60;
	if (numberOfBallots == 200) return 70;
	if (numberOfBallots <= 500) return 70 + 5 * (numberOfBallots - 200) / 100;
	if (numberOfBallots <= 1000) return 85 + 3 * (numberOfBallots - 500) / 100;
	if (numberOfBallots <= 10000) return 100 + 2.22 * (numberOfBallots - 1000) / 100;

	return (numberOfBallots) * 0.0183;
}

$(function() {

	$("#add-destination-button").click(function(event) {
		event.stopImmediatePropagation();
		event.preventDefault();
		addSearch();
	});

	$("#region-select").change(function() {
		var region = getRegion($(this).val());

		if (region) {
			$("#selection").html("Region : " + region.reg_name + "<br>Nombre de villes : " + region.reg_number_of_cities + "<br>Population : " + numberFormat.format(region.reg_population * 1000) + " habitants<br>Electeurs : ~" + numberFormat.format(numberOfElectors(region.reg_population * 1000)));

			getNumberOfBallots({"region" : region.reg_name, "proportion": proportion, type: "region"});
		}
		else {
			$("#selection").html("");
			actualSearch = null;
		}
	});

	$("#departement-select").change(function() {
		var department = getDepartment($(this).val());

		if (department) {
			$("#selection").html("Departement : " + department.dep_name + "<br>Nombre de villes : " + department.dep_number_of_cities + "<br>Population : " + numberFormat.format(department.dep_population * 1000) + " habitants<br>Electeurs : ~" + numberFormat.format(numberOfElectors(department.dep_population * 1000)));

			getNumberOfBallots({"department" : department.dep_name, "proportion": proportion, type: "departement"});
		}
		else {
			$("#selection").html("");
			actualSearch = null;
		}
	});

	$("#city-autocomplete").change(function() {
		var city = $(this).val();

		if (city) {
//			$("#selection").html("Departement : " + department.dep_name + "<br>Nombre de villes : " + department.dep_number_of_cities + "<br>Population : " + numberFormat.format(department.dep_population * 1000) + " habitants<br>Electeurs : ~" + numberFormat.format(numberOfElectors(department.dep_population * 1000)));

			$("#selection").html("");
			getNumberOfBallots({"city" : city, "proportion": proportion, type: "villes"});
		}
		else {
			$("#selection").html("");
			actualSearch = null;
		}
	});

	$("#proportion").change(function() {
		proportion = $(this).val();
	});
});

</script>

<!-- END BULLETIN -->

</body>

</html>
